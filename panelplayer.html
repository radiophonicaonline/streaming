<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Player con Autoplay + Crossfade</title>
<style>
  body{background:#111;color:#eee;font-family:Arial;margin:0;padding:10px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  button{background:#222;color:#eee;border:1px solid #444;padding:8px 12px;border-radius:6px;cursor:pointer}
  button:hover{background:#333}
  input[type=range]{width:140px}
  #list{max-height:220px;overflow:auto;border:1px solid #333;border-radius:6px;padding:6px}
  .item{padding:4px 6px;border-radius:4px;cursor:pointer}
  .item:hover{background:#222}
  .active{background:#2a2a2a}
  video{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000}
  #stage{position:relative;width:100%;height:60vh;background:#000;border-radius:8px;overflow:hidden}
</style>
</head>
<body>

<div class="controls">
  <input id="files" type="file" accept="video/*,audio/*" multiple webkitdirectory />
  <button id="prev">⏮ Anterior</button>
  <button id="play">▶ Play</button>
  <button id="pause">⏸ Pause</button>
  <button id="stop">⏹ Stop</button>
  <button id="next">⏭ Siguiente</button>
  <label><input id="auto" type="checkbox" checked /> Auto</label>
  <label>Vol <input id="vol" type="range" min="0" max="1" step="0.01" value="1"></label>
</div>

<div id="list"></div>

<div id="stage">
  <video id="v1" playsinline></video>
  <video id="v2" playsinline style="opacity:0"></video>
</div>

<script>
const filesInput = document.getElementById('files');
const listDiv = document.getElementById('list');
const v1 = document.getElementById('v1');
const v2 = document.getElementById('v2');
const autoChk = document.getElementById('auto');
const vol = document.getElementById('vol');

let items = [];
let index = -1;
let front = v1; // video visible
let back = v2;  // video oculto
const FADE = 1.2; // segundos

function swap(){ const t = front; front = back; back = t; }

function renderList(){
  listDiv.innerHTML = '';
  items.forEach((it,i)=>{
    const d = document.createElement('div');
    d.className = 'item' + (i===index?' active':'');
    d.textContent = it.name;
    d.onclick = ()=> playIndex(i,true);
    listDiv.appendChild(d);
  });
}

filesInput.onchange = e=>{
  items = Array.from(e.target.files);
  index = items.length ? 0 : -1;
  renderList();
};

function setVolume(v){ front.volume = v; back.volume = v; }
vol.oninput = e=> setVolume(parseFloat(e.target.value));

async function playIndex(i, fade){
  if(i<0 || i>=items.length) return;
  index = i; renderList();
  const file = items[i];
  const url = URL.createObjectURL(file);

  back.src = url;
  back.currentTime = 0;
  back.volume = 0;
  await back.play().catch(()=>{});

  if(fade){
    back.style.opacity = 1;
    const steps = 30;
    for(let s=0;s<=steps;s++){
      const k = s/steps;
      back.volume = k * vol.value;
      front.volume = (1-k) * vol.value;
      back.style.opacity = k;
      front.style.opacity = 1-k;
      await new Promise(r=>setTimeout(r, FADE*1000/steps));
    }
    front.pause();
    front.src = '';
    front.style.opacity = 0;
    swap();
  }else{
    front.src = url;
    front.volume = vol.value;
    await front.play().catch(()=>{});
  }
}

function next(){ if(items.length) playIndex((index+1)%items.length,true); }
function prev(){ if(items.length) playIndex((index-1+items.length)%items.length,true); }

// Autoplay al terminar
v1.onended = v2.onended = ()=>{ if(autoChk.checked) next(); };

// Controles
document.getElementById('next').onclick = next;
document.getElementById('prev').onclick = prev;
document.getElementById('play').onclick = ()=> front.play();
document.getElementById('pause').onclick = ()=> front.pause();
document.getElementById('stop').onclick = ()=>{ front.pause(); front.currentTime=0; };

</script>
</body>
</html>
