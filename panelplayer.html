<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
body{background:#111;color:white;font-family:sans-serif;padding:15px}

button{margin:5px;padding:8px 12px;background:#444;color:white;border:none;cursor:pointer}
button:hover{background:#666}

.item{
  padding:8px;
  border-bottom:1px solid #333;
  display:flex;
  justify-content:space-between;
}

.item span{cursor:pointer}

.fxbtn{
  display:inline-block;
  background:#900;
  padding:10px;
  margin:5px;
  cursor:pointer;
}
</style>
</head>
<body>

<h2>ğŸ¬ Playlist</h2>

<button onclick="cargarVideos()">â• Videos</button>
<button onclick="cargarCarpeta()">ğŸ“‚ Carpeta</button>
<label><input type="checkbox" id="auto" checked> Auto</label>

<div id="lista"></div>

<hr>

<h2>ğŸ›ï¸ Controles</h2>

<button onclick="play()">â–¶</button>
<button onclick="pause()">â¸</button>
<button onclick="stop()">â¹</button>

<hr>

<h2>ğŸ”Š Botonera FX / Jingles</h2>

<button onclick="cargarFX()">â• Cargar FX</button>
<div id="fx"></div>

<input type="file" id="files" accept="video/*" multiple hidden>
<input type="file" id="folder" webkitdirectory hidden>
<input type="file" id="fxfiles" accept="audio/*,video/*" multiple hidden>

<script>
const canal = new BroadcastChannel("obs_player");

let items = []; // archivos o carpetas
let fxlist = [];

const lista = document.getElementById("lista");
const fxdiv = document.getElementById("fx");

function actualizarLista(){
  lista.innerHTML="";

  items.forEach((it,i)=>{
    const div=document.createElement("div");
    div.className="item";

    const span=document.createElement("span");
    span.textContent=it.name;

    span.onclick=()=>{
      if(it.type==="file"){
        canal.postMessage({type:"playFile",file:it.file});
      }
      else{
        canal.postMessage({type:"playFolder",files:it.files});
      }
    };

    const del=document.createElement("button");
    del.textContent="âŒ";
    del.onclick=()=>{
      items.splice(i,1);
      actualizarLista();
    };

    div.appendChild(span);
    div.appendChild(del);
    lista.appendChild(div);
  });
}

function cargarVideos(){ document.getElementById("files").click(); }
function cargarCarpeta(){ document.getElementById("folder").click(); }
function cargarFX(){ document.getElementById("fxfiles").click(); }

document.getElementById("files").onchange=e=>{
  for(const f of e.target.files){
    items.push({type:"file",name:f.name,file:f});
  }
  actualizarLista();
};

document.getElementById("folder").onchange=e=>{
  const files=[...e.target.files];
  const folderName=files[0].webkitRelativePath.split("/")[0];

  items.push({
    type:"folder",
    name:"ğŸ“‚ "+folderName,
    files:files
  });

  actualizarLista();
};

document.getElementById("fxfiles").onchange=e=>{
  for(const f of e.target.files){
    fxlist.push(f);

    const btn=document.createElement("div");
    btn.className="fxbtn";
    btn.textContent=f.name;

    btn.onclick=()=>{
      canal.postMessage({type:"fx",file:f});
    };

    fxdiv.appendChild(btn);
  }
};

function play(){ canal.postMessage({type:"play"}) }
function pause(){ canal.postMessage({type:"pause"}) }
function stop(){ canal.postMessage({type:"stop"}) }

document.getElementById("auto").onchange=e=>{
  canal.postMessage({type:"setAutoplay",value:e.target.checked});
};
</script>

</body>
</html>
