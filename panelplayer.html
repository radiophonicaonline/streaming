<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<style>
body{
  background:#0b0b0b;
  color:#eee;
  font-family:Segoe UI, sans-serif;
  padding:12px;
}

/* BOTONES */

button{
  background:#2a2a2a;
  color:#fff;
  border:none;
  padding:6px 10px;
  margin:3px;
  cursor:pointer;
  border-radius:4px;
  font-size:13px;
}

button:hover{ background:#444 }

/* LISTA */

#lista{
  height:260px;
  overflow-y:auto;
  border:1px solid #222;
  margin-top:8px;
  font-size:13px;
}

.item{
  display:flex;
  justify-content:space-between;
  padding:4px 6px;
  border-bottom:1px solid #1c1c1c;
}

.item:hover{ background:#1a1a1a }

.item span{
  cursor:pointer;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width:240px;
}

/* FX */

.fxbtn{
  display:inline-block;
  background:#7a0d0d;
  padding:6px 8px;
  margin:4px;
  cursor:pointer;
  border-radius:4px;
  font-size:12px;
}

.fxbtn:hover{ background:#a31212 }
</style>
</head>

<body>

<h3>ğŸ¬ Playlist</h3>

<button onclick="cargarVideos()">â• Videos</button>
<button onclick="cargarCarpeta()">ğŸ“‚ Carpeta</button>

<label>
  <input type="checkbox" id="auto" checked> Auto
</label>

<div id="lista"></div>

<h3>ğŸ® NavegaciÃ³n</h3>

<button onclick="prev()">â® Anterior</button>
<button onclick="next()">â­ Siguiente</button>
<button onclick="random()">ğŸ”€ Aleatorio</button>

<h3>ğŸ›ï¸ Controles</h3>

<button onclick="play()">â–¶</button>
<button onclick="pause()">â¸</button>
<button onclick="stop()">â¹</button>

<h3>ğŸ”Š Volumen</h3>

<input type="range"
       min="0" max="1" step="0.01"
       value="1"
       oninput="setVol(this.value)">

<hr>

<h3>ğŸ”Š FX / Jingles</h3>

<button onclick="cargarFX()">â• Cargar FX</button>
<div id="fx"></div>

<input type="file" id="files" accept="video/*" multiple hidden>
<input type="file" id="folder" webkitdirectory hidden>
<input type="file" id="fxfiles" accept="audio/*,video/*" multiple hidden>

<script>
const canal = new BroadcastChannel("obs_player");

let items = [];
let currentIndex = -1;

const lista = document.getElementById("lista");
const fxdiv = document.getElementById("fx");

/* ===== ACTUALIZAR LISTA ===== */

function actualizarLista(){

  lista.innerHTML="";

  items.forEach((it,i)=>{

    const div=document.createElement("div");
    div.className="item";

    const span=document.createElement("span");
    span.textContent=it.name;
    span.onclick=()=> reproducirItem(i);

    const del=document.createElement("button");
    del.textContent="âœ–";
    del.onclick=()=>{
      items.splice(i,1);
      if(currentIndex===i) currentIndex=-1;
      actualizarLista();
    };

    div.appendChild(span);
    div.appendChild(del);
    lista.appendChild(div);
  });
}

/* ===== REPRODUCIR ITEM ===== */

function reproducirItem(i){

  if(i < 0 || i >= items.length) return;

  currentIndex = i;

  const it = items[i];

  if(it.type==="file"){
    canal.postMessage({type:"playFile",file:it.file});
  }
  else{
    canal.postMessage({type:"playFolder",files:it.files});
  }
}

/* ===== NAVEGACIÃ“N ===== */

function next(){

  if(!items.length) return;

  let i = currentIndex + 1;

  if(i >= items.length) i = 0;

  reproducirItem(i);
}

function prev(){

  if(!items.length) return;

  let i = currentIndex - 1;

  if(i < 0) i = items.length - 1;

  reproducirItem(i);
}

function random(){

  if(!items.length) return;

  const i = Math.floor(Math.random() * items.length);

  reproducirItem(i);
}

/* ===== CARGAS ===== */

function cargarVideos(){
  document.getElementById("files").click();
}

function cargarCarpeta(){
  document.getElementById("folder").click();
}

function cargarFX(){
  document.getElementById("fxfiles").click();
}

document.getElementById("files").onchange=e=>{

  for(const f of e.target.files){
    items.push({
      type:"file",
      name:"ğŸ¬ "+f.name,
      file:f
    });
  }

  actualizarLista();
};

document.getElementById("folder").onchange=e=>{

  const files=[...e.target.files];
  const name=files[0].webkitRelativePath.split("/")[0];

  items.push({
    type:"folder",
    name:"ğŸ“‚ "+name,
    files:files
  });

  actualizarLista();
};

/* ===== FX ===== */

document.getElementById("fxfiles").onchange=e=>{

  for(const f of e.target.files){

    const btn=document.createElement("div");
    btn.className="fxbtn";
    btn.textContent=f.name;

    btn.onclick=()=>{
      canal.postMessage({type:"fx",file:f});
    };

    fxdiv.appendChild(btn);
  }
};

/* ===== CONTROLES ===== */

function play(){
  canal.postMessage({type:"play"});
}

function pause(){
  canal.postMessage({type:"pause"});
}

function stop(){
  canal.postMessage({type:"stop"});
}

function setVol(v){
  canal.postMessage({
    type:"volume",
    value:parseFloat(v)
  });
}

document.getElementById("auto").onchange=e=>{
  canal.postMessage({
    type:"setAutoplay",
    value:e.target.checked
  });
};

/* ===== PLAYER PIDE SIGUIENTE ===== */

canal.onmessage = e => {

  const d = e.data;

  if(d.type === "next"){
    next();
  }
};
</script>

</body>
</html>
